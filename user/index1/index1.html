<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="index1.css" />
</head>

<!-- BODY TAG -->

<body>
    <div id="chatApp" class="chatApp">
        <div id="chatContainer" class="chatContainer">
            <h3>Chat hoy ! <br>✿◕ ‿ ◕✿</h3>
            <input id="name" type="text" placeholder="Name..." onchange="setUpName(this.value)" />
            <input id="room" type="text" placeholder="Room..." onchange="setUpRoom(this.value)" />
            <button onclick="joinRoom()">CONNECT</button>
        </div>

        <!-- CONNECT TO CHAT PAGE-->

        <div id="chatWindow" class="chatWindow">
            <div class="chatHeader">
                <p>Chat hoy !</p>
            </div>
            <div class="chatBody">
                <div class="messageContainer">
                    <div class="message">
                        <div>
                            <div id="messageData"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chatFooter">
                <input id="currentMessage" type="text" placeholder="Message..." />
                <button onclick="sendMessage()">&#10148;</button>
            </div>
        </div>
    </div>
    <style>
        .chatWindow {
            display: none;
        }
    </style>
</body>

<!-- SCRIPT TAG -->

<script src="https://cdn.socket.io/4.5.0/socket.io.min.js"
    integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k"
    crossorigin="anonymous"></script>

<!-- SET UP PRIVATE ROOM -->

<script>
    const socket = io("http://localhost:3000");
    let name = document.getElementById("name").value;
    let room = document.getElementById("room").value;
    function setUpName(val) {
        name = val;
    }
    function setUpRoom(val) {
        room = val;
    }
    function joinRoom() {
        if (name !== "" && room !== "") {
            socket.emit("joinRoom", room);
        }
        document.getElementById("chatContainer").remove();
        document.getElementById("chatWindow").style.display = "block";
        document.getElementById("chatApp").style.background = "url(https://previews.123rf.com/images/usbfco/usbfco1212/usbfco121200044/16703615-penguin-family-on-winter-background.jpg) no-repeat center";
    };

    //SET UP CHAT

    let currentMessage = document.getElementById("currentMessage");
    currentMessage.addEventListener("keypress", (e) => {
        e.key === "Enter" && sendMessage();
    })

    const sendMessage = async () => {
        if (currentMessage.value !== "") {
            const messageData = {
                room: room,
                author: name,
                message: currentMessage.value,
                time:
                    new Date(Date.now()).getHours() +
                    ":" +
                    new Date(Date.now()).getMinutes(),
            };

            await socket.emit("send_message", messageData);
            const mes = document.createElement("p");
            mes.innerText = messageData.time + " " + messageData.author + ": " + messageData.message;
            document.getElementById("messageData").appendChild(mes);
            currentMessage.value = "";

        }
    };
    socket.on("receive_message", (data) => {
        const mes = document.createElement("p");
        mes.innerText = data.time + " " + data.author + ": " + data.message;
        document.getElementById("messageData").appendChild(mes);
    });

</script>

</html>